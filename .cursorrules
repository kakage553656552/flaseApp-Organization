# MSPBots App Development Rules

## ğŸ“‹ æ¦‚è¿°

**é¡¹ç›®æ¶æ„**: React 19 + TypeScript + Vite + Tailwind CSS + MSPBots Platform  
**å¯ä¿®æ”¹èŒƒå›´**: `pages/**`ã€`App.tsx`ï¼ˆè·¯ç”±ä¸èœå•é…ç½®ï¼‰ã€`mspbot.config.ts`ï¼ˆå¯é€‰é…ç½®ï¼‰  
**åªè¯»èµ„æº**: `.nexo/**`ï¼ˆå…±äº«ç»„ä»¶ã€å¸ƒå±€ã€å·¥å…·ï¼‰
**é…ç½®æ–‡ä»¶**: 
- `package.json` - é¡¹ç›®ä¾èµ–å’Œ manifest é…ç½®
- `mspbot.config.ts` - å¯é€‰çš„æ„å»ºé…ç½®æ‰©å±•ï¼ˆè¯¦è§"é…ç½®æ‰©å±•"ç« èŠ‚ï¼‰

---

## ğŸ¯ å‰ç«¯å¼€å‘è§„èŒƒ

### è·¯å¾„åˆ«åï¼ˆå¿…é¡»ä½¿ç”¨ï¼‰
```typescript
import { DefaultLayout } from '@/layouts'           // @/* â†’ .nexo/*
import { Button, Card } from '#nexo/ui'             // #nexo/ui â†’ .nexo/components/ui
import { $fetch, inMicroApp } from '#nexo/shared'   // #nexo/shared â†’ .nexo/components/shared
```

### UI ç»„ä»¶è§„èŒƒ
- **æ ·å¼**: ä»…ä½¿ç”¨ Tailwind CSSï¼Œç¦æ­¢å†…è”æ ·å¼
- **ç»„ä»¶**: ä»…ä½¿ç”¨ `#nexo/ui` å†…ç½®ç»„ä»¶ï¼ˆButtonã€Cardã€Inputã€Selectã€Badgeã€Tabsã€Tooltipã€Alertã€Progressã€Skeletonã€ScrollAreaã€Separator ç­‰ï¼‰
- **å›¾æ ‡**: ä»…ä½¿ç”¨ `lucide-react`
- **ç¦æ­¢**: å¼•å…¥ç¬¬ä¸‰æ–¹ UI åº“

### æ–°å¢é¡µé¢æ ‡å‡†æµç¨‹

#### 1. åˆ›å»ºé¡µé¢ç»„ä»¶ï¼ˆ`pages/YourPage.tsx`ï¼‰
```tsx
import { Card, CardHeader, CardTitle, CardContent } from '#nexo/ui'
import { IconName } from 'lucide-react'

export const YourPage: React.FC = () => {
  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle>Page Title</CardTitle>
        </CardHeader>
        <CardContent>
          {/* content */}
        </CardContent>
      </Card>
    </div>
  )
}
```

#### 2. é…ç½®è·¯ç”±ï¼ˆ`package.json â†’ manifest.menus`ï¼‰
```json
{
  "manifest": {
    "menus": [
      {
        "name": "your-page",
        "label": "Your Page",
        "path": "/your-page",
        "icon": "IconName"
      }
    ]
  }
}
```

**èœå•å­—æ®µè¯´æ˜**ï¼š
- `name`: è·¯ç”±çš„å”¯ä¸€æ ‡è¯†ï¼ˆå¿…éœ€ï¼‰ï¼Œç”¨äºæ¨æ–­ç»„ä»¶è·¯å¾„å’Œå¯¼å‡ºåç§°
- `label`: èœå•æ˜¾ç¤ºåç§°ï¼ˆå¿…éœ€ï¼‰
- `path`: è·¯ç”±è·¯å¾„ï¼ˆå¿…éœ€ï¼‰ï¼Œ"/" è¡¨ç¤ºé¦–é¡µï¼ˆindex routeï¼‰
- `icon`: å›¾æ ‡åç§°ï¼ˆå¯é€‰ï¼‰ï¼Œå¯¹åº” `lucide-react` ä¸­çš„å›¾æ ‡ç»„ä»¶å

**è‡ªåŠ¨æ¨æ–­è§„åˆ™**ï¼š
- ç»„ä»¶è·¯å¾„ï¼šä» `name` æ¨æ–­ï¼Œä¾‹å¦‚ "your-page" â†’ "YourPage.tsx"
- å¯¼å‡ºåç§°ï¼šä» `name` æ¨æ–­ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œä¾‹å¦‚ "your-page" â†’ "YourPage"
- è·¯ç”±è·¯å¾„ï¼šä» `path` æ¨æ–­ï¼Œ"/" â†’ index routeï¼Œå…¶ä»–è·¯å¾„ç›´æ¥ä½¿ç”¨

**æ³¨æ„**: 
- è·¯ç”±é…ç½®ç»Ÿä¸€åœ¨ `package.json â†’ manifest.menus` ä¸­ç®¡ç†
- `App.tsx` è‡ªåŠ¨ä» `manifest.menus` è¯»å–å¹¶ç”Ÿæˆè·¯ç”±å’Œèœå•
- ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨

---

## ğŸŒ å¾®å‰ç«¯é›†æˆ

### æ— ç•Œå¾®å‰ç«¯ API

**ç¯å¢ƒæ£€æµ‹ä¸ä¿¡æ¯è·å–**:
```typescript
// æ£€æŸ¥æ˜¯å¦åœ¨æ— ç•Œå¾®å‰ç«¯ç¯å¢ƒä¸­
const isWujieEnv = !!(window as any).__POWERED_BY_WUJIE__ || !!(window as any).$wujie

if (isWujieEnv && window.$wujie) {
  const props = window.$wujie.props              // ä¸»åº”ç”¨ä¼ é€’çš„ props
  const bus = window.$wujie.bus                  // äº‹ä»¶æ€»çº¿
}
```

**äº‹ä»¶é€šä¿¡**:
```typescript
// å‘é€äº‹ä»¶åˆ°ä¸»åº”ç”¨
window.$wujie?.bus.$emit('user-login', { userId: '123' })

// ç›‘å¬ä¸»åº”ç”¨äº‹ä»¶
window.$wujie?.bus.$on('theme-change', (data) => {
  console.log('Theme changed:', data)
})

// å–æ¶ˆç›‘å¬
window.$wujie?.bus.$off('theme-change', handler)
```

**ç”Ÿå‘½å‘¨æœŸå‡½æ•°**ï¼ˆå­åº”ç”¨å…¥å£æ–‡ä»¶ï¼‰:
```typescript
// å­åº”ç”¨æŒ‚è½½
export async function mount(props?: any) {
  // å°† props ä¼ é€’ç»™ window.$wujie.props
  if (props && typeof window !== 'undefined') {
    if (!window.$wujie) {
      (window as any).$wujie = {}
    }
    window.$wujie.props = props
  }
  // æ¸²æŸ“åº”ç”¨
  render(props)
}

// å­åº”ç”¨å¸è½½
export async function unmount(props?: any) {
  // æ¸…ç†èµ„æº
  if (root) {
    root.unmount()
    root = null
  }
}
```

**ä¸»åº”ç”¨ä½¿ç”¨ WujieReact**:
```typescript
import { WujieReact } from 'wujie-react'
import { bus } from 'wujie'

// ç›‘å¬å­åº”ç”¨äº‹ä»¶
bus.$on('sidebar-toggle', (data) => {
  // å¤„ç†äº‹ä»¶
})

// åŠ è½½å­åº”ç”¨
<WujieReact
  name="sub-app"
  url="http://localhost:8002/apps/sub-app"
  sync={true}
  props={{ sidebarState }}
/>
```

**è·¯ç”±æ¨¡å¼å’Œéè·¯ç”±æ¨¡å¼**:
- **è·¯ç”±æ¨¡å¼**ï¼šä½¿ç”¨ `react-router-dom` çš„ `Routes` å’Œ `Route` ç»„ä»¶ï¼ˆreact-template é»˜è®¤æ¨¡å¼ï¼‰
- **éè·¯ç”±æ¨¡å¼**ï¼šä¸ä½¿ç”¨è·¯ç”±ï¼Œç›´æ¥æ¸²æŸ“ç»„ä»¶ï¼ˆé€‚ç”¨äº header/sidebar/layout ç­‰å¾®å‰ç«¯å­åº”ç”¨ï¼‰

### `$fetch` ä½¿ç”¨è§„èŒƒï¼ˆé‡è¦ï¼ï¼‰

**å¿…é¡»ä½¿ç”¨ `$fetch` è°ƒç”¨åç«¯ API**ï¼ˆè‡ªåŠ¨æºå¸¦è®¤è¯å¤´å¹¶æ·»åŠ è·¯ç”±å‰ç¼€ï¼‰:
```typescript
import { $fetch } from '#nexo/shared'

// æ­£ç¡®ç”¨æ³•ï¼šåªèƒ½è°ƒç”¨æœ¬ APP çš„ server.ts API
// $fetch ä¼šè‡ªåŠ¨æ·»åŠ  /apps/${appId}/api å‰ç¼€
const res = await $fetch('./api/hello')
// å®é™…è¯·æ±‚è·¯å¾„: /apps/${appId}/api/hello (dev å’Œ build æ¨¡å¼éƒ½ä¼šè‡ªåŠ¨æ·»åŠ )

if (!res.ok) throw new Error(`Request failed: ${res.status}`)
const data = await res.json()
```

**âš ï¸ å…³é”®æ¶æ„è§„åˆ™**:
- ğŸš« **å‰ç«¯ç¦æ­¢ç›´æ¥è°ƒç”¨ SDK API**ï¼ˆå¦‚ `${GATEWAY_URL}/api/sdk/*`ï¼‰
- âœ… **å‰ç«¯åªèƒ½è°ƒç”¨æœ¬ APP çš„ `server.ts` å®šä¹‰çš„ API**ï¼ˆ`./api/*`ï¼‰
- âœ… æ‰€æœ‰ä¸ SDK çš„äº¤äº’å¿…é¡»é€šè¿‡ `server.ts` çš„ `ctx` å·¥å…·å®Œæˆ
- âœ… æ•°æ®æµå‘ï¼š`å‰ç«¯ç»„ä»¶` â†’ `pages/services/*.ts` â†’ `$fetch('./api/*')` â†’ `server.ts` â†’ `ctx.*`

**`$fetch` ç‰¹æ€§**:
- âœ… **è‡ªåŠ¨æ·»åŠ è·¯ç”±å‰ç¼€**: `./api/hello` â†’ `/apps/${appId}/api/hello`ï¼ˆdev å’Œ build æ¨¡å¼ï¼‰
  - åº”ç”¨ ID ä» `manifest.json` æˆ– `package.json` çš„ `name` å­—æ®µè‡ªåŠ¨è·å–
  - ç¡®ä¿ä¸ä¼šé‡å¤æ·»åŠ å‰ç¼€ï¼ˆå¦‚æœè·¯å¾„å·²åŒ…å« `/apps/${appId}/api`ï¼‰
- âœ… **è‡ªåŠ¨æ³¨å…¥è®¤è¯å¤´**: `token`, `Authorization`, `tenantCode`, `userId`, `headUrl`, `loginAsRoleId`, `loginAsUserId`, `timezoneOffset`, `timezoneId`
- âœ… **å¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„**: `./api/*`ï¼ˆä¸è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼‰
- âš ï¸ **ç¦æ­¢è¦†ç›–æˆ–æ¸…ç©ºè®¤è¯å¤´**
- âš ï¸ **ç»å¯¹ URL**ï¼ˆ`http://` æˆ– `https://`ï¼‰ä¼šç›´æ¥ä¼ é€’ï¼Œä¸ä¼šæ·»åŠ å‰ç¼€

**è·¯ç”±å‰ç¼€è¯´æ˜**:
- Dev æ¨¡å¼: base = `/`ï¼Œè·¯ç”±ä¸º `/apps/${appId}/api/hello`
- Build æ¨¡å¼: base = `/apps/${appName}/`ï¼Œè·¯ç”±ä»ä¸º `/apps/${appId}/api/hello`ï¼ˆä½¿ç”¨ç»å¯¹è·¯å¾„é¿å… base å½±å“ï¼‰
- `$fetch` ä¼šè‡ªåŠ¨å¤„ç†è·¯å¾„è½¬æ¢ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå‰ç¼€

---

## âš™ï¸ åç«¯å¼€å‘è§„èŒƒ

### è·¯ç”±å®šä¹‰è§„èŒƒ

**æ–‡ä»¶**: `server.ts` â†’ æ„å»ºå `server.js`  
**æ ¼å¼**: `async 'METHOD /api/path'(req: Request, ctx: Context)`

```typescript
const routes: ServerExports = {
  async 'GET /api/data'(req: Request, ctx: Context) {
    return { message: 'Hello', appId: ctx.app.id }
  },
  
  async 'POST /api/data'(req: Request, ctx: Context) {
    const body = await req.json()
    return { success: true, received: body }
  },
  
  async 'GET /api/items/:id'(req: Request, ctx: Context) {
    const id = ctx.params.id  // Path parameter
    return { id }
  },
}

export default routes
```

**è·¯ç”±å‰ç¼€è¯´æ˜**:
- âœ… **å¼€å‘æ¨¡å¼**ï¼ˆ`mspbots dev`ï¼‰: è·¯ç”±ä¼šè‡ªåŠ¨æ·»åŠ  `/apps/${appId}/api` å‰ç¼€
  - å®šä¹‰: `'GET /api/hello'` â†’ å®é™…è·¯ç”±: `GET /apps/${appId}/api/hello`
  - åº”ç”¨ ID ä» `manifest.json` æˆ– `package.json` çš„ `name` å­—æ®µè‡ªåŠ¨è·å–
- âœ… **æ„å»ºæ¨¡å¼**ï¼ˆ`mspbots build`ï¼‰: è·¯ç”±åŒæ ·ä¼šæ·»åŠ  `/apps/${appId}/api` å‰ç¼€
- âš ï¸ **ä¸è¦æ‰‹åŠ¨æ·»åŠ åº”ç”¨ ID å‰ç¼€**: åœ¨ `server.ts` ä¸­ç›´æ¥å®šä¹‰ `'GET /api/hello'` å³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†

**æ³¨æ„**: ç±»å‹ `Context` å’Œ `ServerExports` ç”± `@mspbots/server` åŒ…è‡ªåŠ¨æä¾›ï¼Œæ— éœ€æ‰‹åŠ¨å¯¼å…¥ã€‚

### Context å¯¹è±¡

Context æä¾›åº”ç”¨çš„åŸºç¡€ä¿¡æ¯ï¼š

```typescript
interface Context {
  app: {
    id: string              // åº”ç”¨ ID
    name: string            // åº”ç”¨åç§°
    version?: string        // åº”ç”¨ç‰ˆæœ¬
    description?: string    // åº”ç”¨æè¿°
    icon?: string           // åº”ç”¨å›¾æ ‡
    permissions?: Record<string, unknown>  // åº”ç”¨æƒé™é…ç½®
  }
}
```

### å…¨å±€ api() å‡½æ•°

**ä»…åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨**ï¼ˆ`mspbots dev`ï¼‰

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å…¨å±€ `api()` å‡½æ•°è°ƒç”¨ Gateway SDK APIï¼š

```typescript
// è°ƒç”¨ KV Store
const result = await api(`/apps/${ctx.app.id}/sdk/kv/set`, {
  method: 'POST',
  body: { key: 'myKey', value: { data: 'value' } },
});

// è°ƒç”¨ HTTP Client
const result = await api(`/apps/${ctx.app.id}/sdk/http/fetch`, {
  method: 'POST',
  body: { url: 'https://api.example.com' },
});

// è°ƒç”¨ LangChain
const result = await api(`/apps/${ctx.app.id}/sdk/langchain/chat`, {
  method: 'POST',
  body: { 
    prompt: 'Hello AI',
    options: { model: 'gpt-3.5-turbo' }
  },
});

// ä½¿ç”¨è‡ªå®šä¹‰ headersï¼ˆä¸ä¼šè¦†ç›– Content-Type å’Œ X-App-Idï¼‰
const result = await api(`/apps/${ctx.app.id}/sdk/kv/set`, {
  method: 'POST',
  body: { key, value },
  headers: {
    'X-Custom-Header': 'custom-value',
    'Authorization': 'Bearer token',
  },
});
```

**ç‰¹ç‚¹**ï¼š
- âœ… è‡ªåŠ¨åºåˆ—åŒ– body ä¸º JSONï¼ˆä¼ å¯¹è±¡å³å¯ï¼‰
- âœ… è‡ªåŠ¨å¤„ç† Gateway URL é…ç½®
- âœ… è‡ªåŠ¨æ·»åŠ  `Content-Type: application/json` å¤´
- âœ… è‡ªåŠ¨æ·»åŠ  `X-App-Id` å¤´ï¼ˆå€¼ä¸º `ctx.app.id`ï¼‰
- âœ… æ”¯æŒè‡ªå®šä¹‰ headersï¼ˆä¸ä¼šè¦†ç›–è‡ªåŠ¨æ·»åŠ çš„å¤´ï¼‰
- âœ… è‡ªåŠ¨é”™è¯¯å¤„ç†
- âš ï¸ ä»…åœ¨ `mspbots dev` æ—¶å¯ç”¨
- âš ï¸ ç”Ÿäº§ç¯å¢ƒç”±å¹³å°æä¾›åŸç”Ÿ ctx å·¥å…·

**è·¯å¾„æ ¼å¼**ï¼š`/apps/{appId}/sdk/{feature}/{action}`

**æ”¯æŒçš„åŠŸèƒ½**ï¼š
- **KV Store**: `/apps/${ctx.app.id}/sdk/kv/*`
- **HTTP Client**: `/apps/${ctx.app.id}/sdk/http/*`
- **LangChain**: `/apps/${ctx.app.id}/sdk/langchain/*`
- **AppManager**: `/apps/${ctx.app.id}/sdk/appmanager/*`
- **App Menus**: `/apps/${ctx.app.id}/sdk/appmenus/*`

### å®Œæ•´ç¤ºä¾‹

```typescript
import type { Context, ServerExports } from '@mspbots/type'

const routes: ServerExports = {
  async 'GET /api/hello'(req: Request, ctx: Context) {
    return {
      message: 'Hello World!',
      timestamp: new Date().toISOString(),
      app: ctx.app,
    };
  },

  async 'POST /api/data'(req: Request, ctx: Context) {
    const body = await req.json();
    const { key, value } = body;
    
    // ä½¿ç”¨å…¨å±€ api() å‡½æ•°è°ƒç”¨ Gateway SDK
    const result = await api(`/apps/${ctx.app.id}/sdk/kv/set`, {
      method: 'POST',
      body: { key, value },
    });
    
    return result;
  },

  async 'POST /api/ai-chat'(req: Request, ctx: Context) {
    const { prompt } = await req.json();
    
    // è°ƒç”¨ LangChain AI
    const result = await api(`/apps/${ctx.app.id}/sdk/langchain/chat`, {
      method: 'POST',
      body: {
        prompt,
        options: { temperature: 0.7, maxTokens: 200 }
      },
    });
    
    return result;
  },
}

export default routes
```

**å…³é”®æ³¨æ„äº‹é¡¹**:
- âœ… Context åªåŒ…å«åº”ç”¨åŸºç¡€ä¿¡æ¯
- âœ… ä½¿ç”¨å…¨å±€ `api()` å‡½æ•°è°ƒç”¨ Gateway SDK
- âœ… å‰ç«¯ä½¿ç”¨ `$fetch('./api/*')` è°ƒç”¨åç«¯ APIï¼ˆè‡ªåŠ¨æ·»åŠ  `/apps/${appId}/api` å‰ç¼€ï¼‰
- âœ… åç«¯è·¯ç”±å®šä¹‰ `'GET /api/hello'` ä¼šè‡ªåŠ¨æ³¨å†Œä¸º `GET /apps/${appId}/api/hello`
- âš ï¸ `api()` å‡½æ•°ä»…åœ¨å¼€å‘ç¯å¢ƒï¼ˆ`mspbots dev`ï¼‰å¯ç”¨

---

## âš™ï¸ é…ç½®æ‰©å±•ï¼ˆå¯é€‰ï¼‰

### mspbot.config.ts

å¯é€‰é…ç½®æ–‡ä»¶ï¼Œç”¨äºæ‰©å±• Vite æ„å»ºé…ç½®ã€‚CLI æä¾›äº†å†…ç½®çš„é»˜è®¤é…ç½®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦è‡ªå®šä¹‰ã€‚

**ä½•æ—¶ä½¿ç”¨**ï¼š
- éœ€è¦æ·»åŠ è‡ªå®šä¹‰ Vite æ’ä»¶
- éœ€è¦è°ƒæ•´æ„å»ºé€‰é¡¹ï¼ˆå¦‚ chunk å¤§å°é™åˆ¶ï¼‰
- éœ€è¦æ·»åŠ é¢å¤–çš„è·¯å¾„åˆ«å
- éœ€è¦è‡ªå®šä¹‰ public ç›®å½•æˆ– base è·¯å¾„

**é…ç½®ç¤ºä¾‹**ï¼š

```typescript
import { defineConfig } from '@mspbots/client/config'

export default defineConfig({
  // æ–¹å¼1: ä½¿ç”¨å‡½æ•°æ‰©å±•é…ç½®
  vite: (config) => {
    // ä¿®æ”¹é»˜è®¤é…ç½®
    config.build = config.build || {}
    config.build.chunkSizeWarningLimit = 1000
    return config
  },
  
  // æ–¹å¼2: ç›´æ¥æä¾›é…ç½®å¯¹è±¡ï¼ˆä¼šä¸é»˜è®¤é…ç½®æ·±åº¦åˆå¹¶ï¼‰
  // vite: {
  //   build: {
  //     chunkSizeWarningLimit: 1000,
  //   },
  // },
  
  // æ·»åŠ è‡ªå®šä¹‰è·¯å¾„åˆ«å
  aliases: {
    '@components': './src/components',
    '@utils': './src/utils',
  },
  
  // æ·»åŠ é¢å¤–çš„ Vite æ’ä»¶
  // plugins: [
  //   someVitePlugin(),
  // ],
  
  // è‡ªå®šä¹‰ public ç›®å½•ï¼ˆé»˜è®¤ï¼š.nexo/publicï¼‰
  // publicDir: './public',
  
  // è‡ªå®šä¹‰ base è·¯å¾„ï¼ˆé»˜è®¤ï¼š./ï¼‰
  // base: '/my-app/',
})
```

**å†…ç½®é»˜è®¤é…ç½®**ï¼š
- è·¯å¾„åˆ«åï¼š`@/*`, `#nexo/ui`, `#nexo/shared`
- Public ç›®å½•ï¼š`.nexo/public`
- è¾“å‡ºç›®å½•ï¼š`dist/`
- ä»£ç åˆ†å‰²ï¼šVite è‡ªåŠ¨ä¼˜åŒ–
- å‹ç¼©ï¼šesbuild
- æ–‡ä»¶å‘½åï¼š`assets/js/[name]-[hash].js`, `assets/[ext]/[name]-[hash].[ext]`

**æ³¨æ„**ï¼š
- æ­¤æ–‡ä»¶å®Œå…¨å¯é€‰ï¼Œä¸åˆ›å»ºä¹Ÿèƒ½æ­£å¸¸å¼€å‘å’Œæ„å»º
- é…ç½®ä¼šåœ¨ `mspbots dev` å’Œ `mspbots build` æ—¶è‡ªåŠ¨åŠ è½½
- æ”¯æŒ TypeScript (`.ts`) å’Œ JavaScript (`.js`) æ ¼å¼

---

## ğŸ“¦ Manifest é…ç½®

**ä½ç½®**: `package.json â†’ manifest` å­—æ®µ

### åŸºç¡€é…ç½®
```json
{
  "name": "app-management",
  "version": "1.0.0",
  "manifest": {
    "icon": "ğŸ“¦",
    "hasBackend": true,
    "permissions": {
      "kv": true,
      "mspbots": ["chat"],
      "http": []
    }
  }
}
```

### å®Œæ•´æƒé™é…ç½®ï¼ˆåŒ…å«èœå•ï¼‰
```json
{
  "manifest": {
    "icon": "ğŸš€",
    "hasBackend": true,
    "permissions": {
      "kv": true,
      "http": ["https://api.example.com"],
      "mspbots": ["chat", "tools"],
      "langchain": {
        "enabled": true,
        "features": ["chat", "embed"],
        "models": ["gpt-3.5-turbo", "gpt-4"]
      }
    },
    "menus": [
      {
        "name": "home",
        "label": "é¦–é¡µ",
        "path": "/",
        "icon": "Home"
      },
      {
        "name": "settings",
        "label": "è®¾ç½®",
        "path": "/settings",
        "icon": "Settings"
      }
    ]
  }
}
```

---

## ğŸ“š å¿«é€Ÿå‚è€ƒ

### å¼€å‘æ£€æŸ¥æ¸…å•

**å‰ç«¯æ–°å¢é¡µé¢**:
- [ ] åœ¨ `pages/` åˆ›å»ºç»„ä»¶ï¼ˆå‘½åå¯¼å‡ºï¼‰
- [ ] åœ¨ `package.json â†’ manifest.menus` æ·»åŠ è·¯ç”±é…ç½®
- [ ] ä½¿ç”¨ `#nexo/ui` ç»„ä»¶å’Œ Tailwind CSS
- [ ] Icon ä» `lucide-react` å¼•å…¥
- [ ] éœ€è¦è°ƒç”¨ API æ—¶ï¼Œåœ¨ `pages/services/` åˆ›å»º service å±‚ï¼Œä½¿ç”¨ `$fetch('./api/*')` è°ƒç”¨æœ¬ APP çš„ `server.ts` API
- [ ] ä¿®æ”¹é…ç½®åé‡å¯å¼€å‘æœåŠ¡å™¨

**åç«¯æ–°å¢æ¥å£**:
- [ ] æŸ¥çœ‹ Gateway SDK API æ–‡æ¡£äº†è§£å¯ç”¨åŠŸèƒ½
- [ ] åœ¨ `package.json â†’ manifest.permissions` å£°æ˜æƒé™
- [ ] åœ¨ `server.ts` å®šä¹‰è·¯ç”±ï¼ˆè·¯ç”±ä¼šè‡ªåŠ¨æ·»åŠ  `/api/${appId}` å‰ç¼€ï¼‰
- [ ] ä½¿ç”¨å…¨å±€ `api()` å‡½æ•°è°ƒç”¨ Gateway SDK
- [ ] å‰ç«¯ä½¿ç”¨ `$fetch('./api/*')` è°ƒç”¨ï¼ˆä¼šè‡ªåŠ¨è½¬æ¢ä¸º `/api/${appId}/*`ï¼‰

**å¾®å‰ç«¯é›†æˆ**:
- [ ] ä½¿ç”¨ `inMicroApp()` æ£€æµ‹ç¯å¢ƒ
- [ ] é€šè¿‡ `useMicroProps()` è·å–ä¸»åº”ç”¨æ•°æ®
- [ ] ä½¿ç”¨ `sendHost`/`onHost` é€šä¿¡
- [ ] ä½¿ç”¨ `$fetch` è‡ªåŠ¨æºå¸¦è®¤è¯å¤´

### å…³é”®åŸåˆ™

1. **è·¯å¾„åˆ«å**: å§‹ç»ˆä½¿ç”¨ `@/*`ã€`#nexo/ui`ã€`#nexo/shared`
2. **UI ç»„ä»¶**: ä»…ä½¿ç”¨ `#nexo/ui`ï¼Œç¦æ­¢å¼•å…¥ç¬¬ä¸‰æ–¹ UI åº“
3. **å‰ç«¯æ¶æ„**: ğŸš« å‰ç«¯ç»å¯¹ç¦æ­¢ç›´æ¥è°ƒç”¨ SDK APIï¼Œåªèƒ½é€šè¿‡ `$fetch('./api/*')` è°ƒç”¨æœ¬ APP çš„ `server.ts`
4. **Context å¯¹è±¡**: Context åªåŒ…å«åº”ç”¨åŸºç¡€ä¿¡æ¯ï¼ˆid, name, version, description, icon, permissionsï¼‰
5. **ç½‘ç»œè¯·æ±‚**: 
   - å‰ç«¯ï¼šä½¿ç”¨ `$fetch('./api/*')` è°ƒç”¨æœ¬ APP çš„ server.tsï¼ˆè‡ªåŠ¨æ·»åŠ  `/apps/${appId}/api` å‰ç¼€ï¼‰
   - åç«¯ï¼šä½¿ç”¨å…¨å±€ `api()` å‡½æ•°è°ƒç”¨ Gateway SDK
   - è·¯ç”±å‰ç¼€ï¼šdev å’Œ build æ¨¡å¼ä¸‹ï¼Œ`$fetch` å’Œ `server.ts` è·¯ç”±éƒ½ä¼šè‡ªåŠ¨æ·»åŠ  `/apps/${appId}/api` å‰ç¼€
6. **æƒé™ç®¡ç†**: æ‰€æœ‰åç«¯èƒ½åŠ›å¿…é¡»å…ˆåœ¨ manifest å£°æ˜æƒé™
7. **å¼€å‘ç¯å¢ƒ**: `api()` å‡½æ•°ä»…åœ¨ `mspbots dev` æ—¶å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒç”±å¹³å°æä¾›
8. **é…ç½®æ‰©å±•**: 
   - Vite é…ç½®ç”± CLI å†…ç½®æä¾›ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
   - å¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯åˆ›å»º `mspbot.config.ts` æ‰©å±•é…ç½®
   - å¤§å¤šæ•°é¡¹ç›®ä½¿ç”¨é»˜è®¤é…ç½®å³å¯

